<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Detecci√≥n - Spam & Intrusiones</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #2b5876 0%, #4e4376 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .model-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 5px;
        }

        .main-nav {
            display: flex;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
        }

        .nav-btn {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: transparent;
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .nav-btn.active {
            background: rgba(255,255,255,0.3);
            font-weight: 600;
        }

        .content-section {
            display: none;
            padding: 30px;
        }

        .content-section.active {
            display: block;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }

        .panel-title {
            color: #2b5876;
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2b5876;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            transition: all 0.3s;
            margin-bottom: 15px;
        }

        textarea:focus {
            outline: none;
            border-color: #2b5876;
            box-shadow: 0 0 0 3px rgba(43, 88, 118, 0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #495057;
            font-weight: 600;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2b5876;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .feature-input {
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 12px;
        }

        .btn {
            background: linear-gradient(135deg, #2b5876 0%, #4e4376 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(43, 88, 118, 0.3);
        }

        .btn-clear {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn-metrics {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
        }

        .btn-intrusion {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }

        .result-container {
            margin-top: 20px;
            display: none;
        }

        .result-card {
            padding: 20px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 5px solid #2b5876;
        }

        .result-spam {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe3e3 100%);
        }

        .result-ham {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #f0fff4 0%, #dcffe4 100%);
        }

        .result-intrusion {
            border-left-color: #ff416c;
            background: linear-gradient(135deg, #fff0f5 0%, #ffe8e8 100%);
        }

        .result-normal {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #f0fff4 0%, #dcffe4 100%);
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .result-icon {
            font-size: 2rem;
        }

        .result-title {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .result-spam .result-title,
        .result-intrusion .result-title {
            color: #dc3545;
        }

        .result-ham .result-title,
        .result-normal .result-title {
            color: #28a745;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .detail-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
        }

        .detail-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .detail-label {
            color: #6c757d;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metrics-container {
            margin-top: 20px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            text-align: center;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2b5876;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .confusion-matrix {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .confusion-title {
            text-align: center;
            margin-bottom: 10px;
            font-weight: 600;
            color: #495057;
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1px;
            max-width: 250px;
            margin: 0 auto;
            background: #dee2e6;
            border: 1px solid #dee2e6;
        }

        .matrix-cell {
            padding: 10px;
            text-align: center;
            background: white;
            font-weight: 600;
        }

        .matrix-header {
            background: #2b5876;
            color: white;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2b5876;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .file-upload {
            margin: 15px 0;
            padding: 15px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #2b5876;
        }

        .file-input {
            display: none;
        }

        .upload-label {
            display: block;
            color: #495057;
            cursor: pointer;
        }

        .upload-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
            color: #6c757d;
        }

        .model-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .info-item {
            padding: 8px;
            background: white;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .chart-container {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .chart-title {
            text-align: center;
            margin-bottom: 15px;
            color: #2b5876;
            font-weight: 600;
        }

        #protocolChart {
            width: 100% !important;
            height: 300px !important;
        }

        .dataset-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .dataset-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .dataset-stat {
            background: white;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2b5876;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #6c757d;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            border-top: 1px solid #e9ecef;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .features-section {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .feature-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
            padding: 5px;
            border-bottom: 1px solid #f1f1f1;
        }

        .feature-name {
            font-weight: 600;
            color: #495057;
        }

        .feature-value {
            text-align: right;
            color: #2b5876;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üõ°Ô∏è</div>
            <h1>Sistema de Detecci√≥n</h1>
            <p class="subtitle">Spam de Correos & Intrusiones de Red</p>
            <div>
                <span class="model-badge">Modelo: Regresi√≥n Log√≠stica</span>
                <span class="model-badge">Dataset: KDD Cup 1999</span>
            </div>
            
            <div class="main-nav">
                <button class="nav-btn active" onclick="switchSection('spam')">üìß Spam Email</button>
                <button class="nav-btn" onclick="switchSection('intrusion')">üõ°Ô∏è Intrusiones Red</button>
                <button class="nav-btn" onclick="switchSection('metrics')">üìä M√©tricas</button>
                <button class="nav-btn" onclick="switchSection('dataset')">üìÅ Dataset</button>
            </div>
        </header>

        <!-- Secci√≥n Spam Email -->
        <div id="spam-section" class="content-section active">
            <div class="main-content">
                <div class="panel">
                    <h2 class="panel-title">üìß Analizar Correo</h2>
                    
                    <div class="tab-container">
                        <div class="tabs" style="display: flex; border-bottom: 2px solid #e9ecef; margin-bottom: 15px;">
                            <div class="tab active" onclick="switchTab('spam', 'text')" style="padding: 10px 20px; cursor: pointer; border-bottom: 2px solid #2b5876;">üìù Texto</div>
                            <div class="tab" onclick="switchTab('spam', 'file')" style="padding: 10px 20px; cursor: pointer;">üìÅ Archivo</div>
                        </div>
                        
                        <div id="spam-text-tab" class="tab-content" style="display: block;">
                            <textarea id="emailText" placeholder="Pega el contenido del correo aqu√≠..."></textarea>
                        </div>
                        
                        <div id="spam-file-tab" class="tab-content" style="display: none;">
                            <div class="file-upload" onclick="document.getElementById('spamFileInput').click()">
                                <input type="file" id="spamFileInput" class="file-input" accept=".txt,.html,.eml">
                                <div class="upload-icon">üìÇ</div>
                                <div class="upload-label">Haz clic para subir archivo</div>
                            </div>
                            <div id="spamFileInfo" style="margin-top: 10px;"></div>
                        </div>
                    </div>
                    
                    <div class="model-info">
                        <strong>Modelo Spam:</strong> Regresi√≥n Log√≠stica
                        <div class="info-grid">
                            <div class="info-item"><strong>Tipo:</strong> Clasificador lineal</div>
                            <div class="info-item"><strong>Precisi√≥n:</strong> <span id="spamAccuracy">--%</span></div>
                            <div class="info-item"><strong>Caracter√≠sticas:</strong> 5000 TF-IDF</div>
                            <div class="info-item"><strong>Dataset:</strong> TREC07P</div>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="analyzeEmail()">
                        Analizar Correo
                    </button>
                    <button class="btn btn-clear" onclick="clearSpamAnalysis()">
                        Limpiar
                    </button>
                    
                    <div class="loading" id="spamLoading">
                        <div class="spinner"></div>
                        <p>Analizando correo...</p>
                    </div>
                    
                    <div class="result-container" id="spamResultContainer">
                        <div class="result-card" id="spamResultCard">
                            <div class="result-header">
                                <div class="result-icon" id="spamResultIcon">üìß</div>
                                <div>
                                    <h3 class="result-title" id="spamResultTitle">Resultado</h3>
                                    <p id="spamResultSubtitle">Modelo: Regresi√≥n Log√≠stica</p>
                                </div>
                            </div>
                            
                            <div class="result-details" id="spamResultDetails"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Panel info Spam -->
                <div class="panel">
                    <h2 class="panel-title">‚ÑπÔ∏è Informaci√≥n Spam</h2>
                    <div class="dataset-info">
                        <strong>Dataset TREC07P</strong>
                        <div class="dataset-stats">
                            <div class="dataset-stat">
                                <div class="stat-number">75,419</div>
                                <div class="stat-label">Correos totales</div>
                            </div>
                            <div class="dataset-stat">
                                <div class="stat-number">52,790</div>
                                <div class="stat-label">Correos Ham</div>
                            </div>
                            <div class="dataset-stat">
                                <div class="stat-number">22,629</div>
                                <div class="stat-label">Correos Spam</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-title">Distribuci√≥n de Clases</div>
                        <canvas id="spamChart"></canvas>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h3 style="color: #2b5876; margin-bottom: 10px;">Caracter√≠sticas del Modelo</h3>
                        <ul style="padding-left: 20px; color: #495057;">
                            <li>Vectorizaci√≥n TF-IDF con 5000 caracter√≠sticas</li>
                            <li>Preprocesamiento: tokenizaci√≥n, eliminaci√≥n stopwords</li>
                            <li>Regularizaci√≥n L2</li>
                            <li>Optimizaci√≥n con gradiente descendente</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n Intrusiones de Red -->
        <div id="intrusion-section" class="content-section">
            <div class="main-content">
                <div class="panel">
                    <h2 class="panel-title">üõ°Ô∏è Analizar Conexi√≥n de Red</h2>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #495057; margin-bottom: 15px;">Caracter√≠sticas Principales</h3>
                        
                        <div class="features-grid">
                            <div class="form-group">
                                <label for="protocol_type">Tipo de Protocolo</label>
                                <select id="protocol_type">
                                    <option value="tcp">TCP</option>
                                    <option value="udp">UDP</option>
                                    <option value="icmp">ICMP</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="service">Servicio</label>
                                <select id="service">
                                    <option value="http">HTTP</option>
                                    <option value="ftp">FTP</option>
                                    <option value="smtp">SMTP</option>
                                    <option value="ssh">SSH</option>
                                    <option value="telnet">Telnet</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="features-section">
                            <h4 style="color: #495057; margin-bottom: 10px;">Par√°metros de Conexi√≥n</h4>
                            <div class="feature-row">
                                <div class="feature-name">Duraci√≥n (s)</div>
                                <input type="number" id="duration" class="feature-input" value="0" step="0.1">
                            </div>
                            <div class="feature-row">
                                <div class="feature-name">Bytes Origen</div>
                                <input type="number" id="src_bytes" class="feature-input" value="491">
                            </div>
                            <div class="feature-row">
                                <div class="feature-name">Bytes Destino</div>
                                <input type="number" id="dst_bytes" class="feature-input" value="0">
                            </div>
                            <div class="feature-row">
                                <div class="feature-name">Count</div>
                                <input type="number" id="count" class="feature-input" value="1" step="0.1">
                            </div>
                            <div class="feature-row">
                                <div class="feature-name">Srv Count</div>
                                <input type="number" id="srv_count" class="feature-input" value="1" step="0.1">
                            </div>
                        </div>
                        
                        <button class="btn btn-intrusion" onclick="analyzeIntrusion()">
                            Analizar Conexi√≥n
                        </button>
                        <button class="btn" onclick="loadSampleIntrusion()">
                            Cargar Ejemplo
                        </button>
                        
                        <div class="loading" id="intrusionLoading">
                            <div class="spinner"></div>
                            <p>Analizando conexi√≥n...</p>
                        </div>
                        
                        <div class="result-container" id="intrusionResultContainer">
                            <div class="result-card" id="intrusionResultCard">
                                <div class="result-header">
                                    <div class="result-icon" id="intrusionResultIcon">üõ°Ô∏è</div>
                                    <div>
                                        <h3 class="result-title" id="intrusionResultTitle">Resultado</h3>
                                        <p id="intrusionResultSubtitle">Modelo: Random Forest</p>
                                    </div>
                                </div>
                                
                                <div class="result-details" id="intrusionResultDetails"></div>
                                
                                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                                    <strong>Tipo de Ataque detectado:</strong>
                                    <div id="attackType" style="color: #dc3545; font-weight: 600; margin-top: 5px;">Normal</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Panel info Intrusiones -->
                <div class="panel">
                    <h2 class="panel-title">üìä Dataset KDD Cup 1999</h2>
                    
                    <div class="dataset-info">
                        <strong>Estad√≠sticas del Dataset</strong>
                        <div class="dataset-stats">
                            <div class="dataset-stat">
                                <div class="stat-number">125,973</div>
                                <div class="stat-label">Conexiones totales</div>
                            </div>
                            <div class="dataset-stat">
                                <div class="stat-number">75,583</div>
                                <div class="stat-label">Training Set</div>
                            </div>
                            <div class="dataset-stat">
                                <div class="stat-number">25,195</div>
                                <div class="stat-label">Test Set</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-title">Distribuci√≥n por Tipo de Protocolo</div>
                        <canvas id="protocolChart"></canvas>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h3 style="color: #2b5876; margin-bottom: 10px;">Caracter√≠sticas del Modelo</h3>
                        <ul style="padding-left: 20px; color: #495057;">
                            <li>42 caracter√≠sticas por conexi√≥n</li>
                            <li>Clasificaci√≥n multiclase</li>
                            <li>Modelo: Random Forest</li>
                            <li>Precisi√≥n: ~99%</li>
                            <li>Tipos de ataque: 23 diferentes</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n M√©tricas -->
        <div id="metrics-section" class="content-section">
            <div class="main-content">
                <div class="panel">
                    <h2 class="panel-title">üìà M√©tricas Spam Model</h2>
                    <button class="btn btn-metrics" onclick="loadSpamMetrics()">
                        Actualizar M√©tricas Spam
                    </button>
                    
                    <div class="loading" id="spamMetricsLoading">
                        <div class="spinner"></div>
                        <p>Cargando m√©tricas...</p>
                    </div>
                    
                    <div id="spamMetricsContent">
                        <!-- Las m√©tricas de spam se cargar√°n aqu√≠ -->
                    </div>
                </div>
                
                <div class="panel">
                    <h2 class="panel-title">üìä M√©tricas Intrusion Model</h2>
                    <button class="btn btn-metrics" onclick="loadIntrusionMetrics()">
                        Actualizar M√©tricas Intrusion
                    </button>
                    
                    <div class="loading" id="intrusionMetricsLoading">
                        <div class="spinner"></div>
                        <p>Cargando m√©tricas...</p>
                    </div>
                    
                    <div id="intrusionMetricsContent">
                        <!-- Las m√©tricas de intrusiones se cargar√°n aqu√≠ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n Dataset -->
        <div id="dataset-section" class="content-section">
            <div class="panel">
                <h2 class="panel-title">üìÅ Dataset KDD Cup 1999</h2>
                
                <div class="dataset-info">
                    <h3 style="color: #2b5876; margin-bottom: 15px;">Informaci√≥n General</h3>
                    <div class="info-grid">
                        <div class="info-item"><strong>Total de registros:</strong> 125,973</div>
                        <div class="info-item"><strong>Caracter√≠sticas:</strong> 42</div>
                        <div class="info-item"><strong>Num√©ricas:</strong> 34</div>
                        <div class="info-item"><strong>Categ√≥ricas:</strong> 8</div>
                        <div class="info-item"><strong>Clases:</strong> 23 tipos de ataques</div>
                        <div class="info-item"><strong>Normal:</strong> ~20% del dataset</div>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <h3 style="color: #2b5876; margin-bottom: 10px;">Ejemplo de datos</h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 12px; overflow-x: auto;">
                        0,tcp,ftp_data,SF,491,0.1,0.2,0.3,0.4,0.5,...,normal,20<br>
                        0,udp,other,SF,146,0,0,0,0,0,...,normal,15<br>
                        0,tcp,private,S0,0,0,0,0,0,0,...,neptune,19<br>
                        0,tcp,http,SF,232,8153,0,0,0,0,...,normal,21
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">Divisi√≥n del Dataset</div>
                    <canvas id="datasetSplitChart"></canvas>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3 style="color: #2b5876; margin-bottom: 10px;">Caracter√≠sticas Principales</h3>
                    <div class="features-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div class="form-group">
                            <label>duration</label>
                            <div style="padding: 8px; background: white; border-radius: 4px;">Duraci√≥n de conexi√≥n</div>
                        </div>
                        <div class="form-group">
                            <label>protocol_type</label>
                            <div style="padding: 8px; background: white; border-radius: 4px;">TCP/UDP/ICMP</div>
                        </div>
                        <div class="form-group">
                            <label>service</label>
                            <div style="padding: 8px; background: white; border-radius: 4px;">Tipo de servicio</div>
                        </div>
                        <div class="form-group">
                            <label>src_bytes</label>
                            <div style="padding: 8px; background: white; border-radius: 4px;">Bytes origen</div>
                        </div>
                        <div class="form-group">
                            <label>dst_bytes</label>
                            <div style="padding: 8px; background: white; border-radius: 4px;">Bytes destino</div>
                        </div>
                        <div class="form-group">
                            <label>flag</label>
                            <div style="padding: 8px; background: white; border-radius: 4px;">Estado conexi√≥n</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Sistema de Detecci√≥n - Spam Email & Intrusiones de Red | Modelos: Regresi√≥n Log√≠stica & Random Forest</p>
            <p>Datasets: TREC07P & KDD Cup 1999</p>
        </footer>
    </div>

    <script>
        // Variables globales
        let spamChartInstance = null;
        let protocolChartInstance = null;
        let datasetSplitChartInstance = null;
        
        // Inicializar al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadSampleData();
        });
        
        // Cambiar secciones
        function switchSection(section) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.remove('active');
            });
            document.getElementById(`${section}-section`).classList.add('active');
        }
        
        // Cambiar tabs dentro de secciones
        function switchTab(section, tabName) {
            const tabs = event.target.parentElement.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
                tab.style.borderBottom = '2px solid transparent';
            });
            event.target.classList.add('active');
            event.target.style.borderBottom = '2px solid #2b5876';
            
            if (section === 'spam') {
                document.getElementById('spam-text-tab').style.display = tabName === 'text' ? 'block' : 'none';
                document.getElementById('spam-file-tab').style.display = tabName === 'file' ? 'block' : 'none';
            }
        }
        
        // Inicializar gr√°ficos
        function initializeCharts() {
            // Gr√°fico de distribuci√≥n Spam
            const spamCtx = document.getElementById('spamChart').getContext('2d');
            spamChartInstance = new Chart(spamCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Ham (70%)', 'Spam (30%)'],
                    datasets: [{
                        data: [70, 30],
                        backgroundColor: ['#28a745', '#dc3545'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Gr√°fico de distribuci√≥n de protocolos
            const protocolCtx = document.getElementById('protocolChart').getContext('2d');
            protocolChartInstance = new Chart(protocolCtx, {
                type: 'bar',
                data: {
                    labels: ['TCP', 'UDP', 'ICMP', 'Other'],
                    datasets: [{
                        label: 'Cantidad de Conexiones',
                        data: [85000, 30000, 10000, 973],
                        backgroundColor: ['#2b5876', '#4e4376', '#00b09b', '#ff416c'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'N√∫mero de Conexiones'
                            }
                        }
                    }
                }
            });
            
            // Gr√°fico de divisi√≥n del dataset
            const datasetCtx = document.getElementById('datasetSplitChart').getContext('2d');
            datasetSplitChartInstance = new Chart(datasetCtx, {
                type: 'pie',
                data: {
                    labels: ['Training Set (60%)', 'Validation Set (20%)', 'Test Set (20%)'],
                    datasets: [{
                        data: [75583, 25195, 25195],
                        backgroundColor: ['#2b5876', '#4e4376', '#00b09b']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    let percentage = context.dataset.data[context.dataIndex];
                                    if (context.dataset.data.length > 0) {
                                        const total = context.dataset.data.reduce((a, b) => a + b);
                                        percentage = Math.round((value / total) * 100);
                                    }
                                    return `${label}: ${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Cargar datos de ejemplo
        function loadSampleData() {
            // Datos de ejemplo para intrusiones
            document.getElementById('duration').value = 0;
            document.getElementById('src_bytes').value = 491;
            document.getElementById('dst_bytes').value = 0;
            document.getElementById('count').value = 1;
            document.getElementById('srv_count').value = 1;
        }
        
        // Analizar email
        async function analyzeEmail() {
            const emailContent = document.getElementById('emailText').value.trim();
            
            if (!emailContent) {
                alert('Por favor, ingresa el contenido del correo');
                return;
            }
            
            document.getElementById('spamLoading').style.display = 'block';
            document.getElementById('spamResultContainer').style.display = 'none';
            
            // Simulaci√≥n de an√°lisis
            setTimeout(() => {
                const isSpam = Math.random() > 0.7;
                showSpamResult(isSpam);
                document.getElementById('spamLoading').style.display = 'none';
            }, 1500);
        }
        
        // Mostrar resultados de spam
        function showSpamResult(isSpam) {
            const spamProbability = isSpam ? (Math.random() * 0.3 + 0.7) : (Math.random() * 0.3);
            const confidence = Math.max(spamProbability, 1 - spamProbability);
            
            const resultCard = document.getElementById('spamResultCard');
            const resultIcon = document.getElementById('spamResultIcon');
            const resultTitle = document.getElementById('spamResultTitle');
            const resultSubtitle = document.getElementById('spamResultSubtitle');
            const resultDetails = document.getElementById('spamResultDetails');
            
            resultCard.className = `result-card ${isSpam ? 'result-spam' : 'result-ham'}`;
            resultIcon.textContent = isSpam ? 'üö´' : '‚úÖ';
            resultTitle.textContent = isSpam ? 'CORREO SPAM DETECTADO' : 'CORREO LEG√çTIMO';
            resultSubtitle.innerHTML = `Confianza: <strong>${(confidence * 100).toFixed(1)}%</strong>`;
            
            resultDetails.innerHTML = `
                <div class="detail-card">
                    <div class="detail-value">${isSpam ? 'SPAM' : 'HAM'}</div>
                    <div class="detail-label">Clasificaci√≥n</div>
                </div>
                <div class="detail-card">
                    <div class="detail-value">${(spamProbability * 100).toFixed(1)}%</div>
                    <div class="detail-label">Prob. Spam</div>
                </div>
                <div class="detail-card">
                    <div class="detail-value">${((1 - spamProbability) * 100).toFixed(1)}%</div>
                    <div class="detail-label">Prob. Ham</div>
                </div>
                <div class="detail-card">
                    <div class="detail-value">${(confidence * 100).toFixed(1)}%</div>
                    <div class="detail-label">Confianza</div>
                </div>
            `;
            
            document.getElementById('spamResultContainer').style.display = 'block';
        }
        
        // Analizar intrusi√≥n
        async function analyzeIntrusion() {
            document.getElementById('intrusionLoading').style.display = 'block';
            document.getElementById('intrusionResultContainer').style.display = 'none';
            
            // Simulaci√≥n de an√°lisis
            setTimeout(() => {
                const isIntrusion = Math.random() > 0.6;
                showIntrusionResult(isIntrusion);
                document.getElementById('intrusionLoading').style.display = 'none';
            }, 2000);
        }
        
        // Mostrar resultados de intrusi√≥n
        function showIntrusionResult(isIntrusion) {
            const intrusionProbability = isIntrusion ? (Math.random() * 0.4 + 0.6) : (Math.random() * 0.4);
            const confidence = Math.max(intrusionProbability, 1 - intrusionProbability);
            const attackTypes = ['neptune', 'smurf', 'back', 'teardrop', 'normal'];
            const detectedAttack = isIntrusion ? attackTypes[Math.floor(Math.random() * 4)] : 'normal';
            
            const resultCard = document.getElementById('intrusionResultCard');
            const resultIcon = document.getElementById('intrusionResultIcon');
            const resultTitle = document.getElementById('intrusionResultTitle');
            const resultSubtitle = document.getElementById('intrusionResultSubtitle');
            const resultDetails = document.getElementById('intrusionResultDetails');
            
            resultCard.className = `result-card ${isIntrusion ? 'result-intrusion' : 'result-normal'}`;
            resultIcon.textContent = isIntrusion ? '‚ö†Ô∏è' : '‚úÖ';
            resultTitle.textContent = isIntrusion ? 'INTRUSI√ìN DETECTADA' : 'CONEXI√ìN NORMAL';
            resultSubtitle.innerHTML = `Confianza: <strong>${(confidence * 100).toFixed(1)}%</strong>`;
            
            resultDetails.innerHTML = `
                <div class="detail-card">
                    <div class="detail-value">${isIntrusion ? 'ATAQUE' : 'NORMAL'}</div>
                    <div class="detail-label">Clasificaci√≥n</div>
                </div>
                <div class="detail-card">
                    <div class="detail-value">${(intrusionProbability * 100).toFixed(1)}%</div>
                    <div class="detail-label">Prob. Ataque</div>
                </div>
                <div class="detail-card">
                    <div class="detail-value">${((1 - intrusionProbability) * 100).toFixed(1)}%</div>
                    <div class="detail-label">Prob. Normal</div>
                </div>
                <div class="detail-card">
                    <div class="detail-value">${(confidence * 100).toFixed(1)}%</div>
                    <div class="detail-label">Confianza</div>
                </div>
            `;
            
            document.getElementById('attackType').textContent = detectedAttack.toUpperCase();
            document.getElementById('attackType').style.color = isIntrusion ? '#dc3545' : '#28a745';
            
            document.getElementById('intrusionResultContainer').style.display = 'block';
        }
        
        // Cargar ejemplo de intrusi√≥n
        function loadSampleIntrusion() {
            const examples = [
                {duration: 0, src_bytes: 491, dst_bytes: 0, count: 1, srv_count: 1, protocol: 'tcp', service: 'ftp_data'},
                {duration: 0, src_bytes: 146, dst_bytes: 0, count: 0, srv_count: 0, protocol: 'udp', service: 'other'},
                {duration: 232, src_bytes: 8153, dst_bytes: 0, count: 1.0, srv_count: 0.03, protocol: 'tcp', service: 'http'}
            ];
            
            const example = examples[Math.floor(Math.random() * examples.length)];
            
            document.getElementById('duration').value = example.duration;
            document.getElementById('src_bytes').value = example.src_bytes;
            document.getElementById('dst_bytes').value = example.dst_bytes;
            document.getElementById('count').value = example.count;
            document.getElementById('srv_count').value = example.srv_count;
            document.getElementById('protocol_type').value = example.protocol;
            document.getElementById('service').value = example.service;
        }
        
        // Cargar m√©tricas de spam
        async function loadSpamMetrics() {
            document.getElementById('spamMetricsLoading').style.display = 'block';
            document.getElementById('spamMetricsContent').innerHTML = '';
            
            // Simulaci√≥n de carga de m√©tricas
            setTimeout(() => {
                const metrics = {
                    accuracy: (Math.random() * 10 + 90).toFixed(1),
                    precision: (Math.random() * 10 + 88).toFixed(1),
                    recall: (Math.random() * 10 + 85).toFixed(1),
                    f1_score: (Math.random() * 10 + 86).toFixed(1),
                    train_size: '52,790',
                    test_size: '22,629',
                    confusion_matrix: [[4500, 120], [80, 2300]]
                };
                
                displaySpamMetrics(metrics);
                document.getElementById('spamAccuracy').textContent = `${metrics.accuracy}%`;
                document.getElementById('spamMetricsLoading').style.display = 'none';
            }, 1000);
        }
        
        // Mostrar m√©tricas de spam
        function displaySpamMetrics(metrics) {
            let html = `
                <div class="stats-summary" style="display: flex; justify-content: space-around; background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <div class="stat-item" style="text-align: center;">
                        <div class="stat-number" style="font-size: 1.5rem; font-weight: 700; color: #2b5876;">${metrics.accuracy}%</div>
                        <div class="stat-label" style="font-size: 0.8rem; color: #6c757d;">Accuracy</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="font-size: 1.5rem; font-weight: 700; color: #2b5876;">${metrics.precision}%</div>
                        <div class="stat-label">Precision</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="font-size: 1.5rem; font-weight: 700; color: #2b5876;">${metrics.recall}%</div>
                        <div class="stat-label">Recall</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="font-size: 1.5rem; font-weight: 700; color: #2b5876;">${metrics.f1_score}%</div>
                        <div class="stat-label">F1-Score</div>
                    </div>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">${metrics.train_size}</div>
                        <div class="metric-label">Muestras Entrenamiento</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${metrics.test_size}</div>
                        <div class="metric-label">Muestras Test</div>
                    </div>
                </div>
            `;
            
            // Matriz de confusi√≥n
            if (metrics.confusion_matrix) {
                const cm = metrics.confusion_matrix;
                html += `
                    <div class="confusion-matrix">
                        <div class="confusion-title">Matriz de Confusi√≥n</div>
                        <div class="matrix-grid">
                            <div class="matrix-cell matrix-header"></div>
                            <div class="matrix-cell matrix-header">Pred Ham</div>
                            <div class="matrix-cell matrix-header">Pred Spam</div>
                            
                            <div class="matrix-cell matrix-header">Real Ham</div>
                            <div class="matrix-cell">${cm[0][0]}</div>
                            <div class="matrix-cell">${cm[0][1]}</div>
                            
                            <div class="matrix-cell matrix-header">Real Spam</div>
                            <div class="matrix-cell">${cm[1][0]}</div>
                            <div class="matrix-cell">${cm[1][1]}</div>
                        </div>
                        <div style="margin-top: 10px; text-align: center; font-size: 0.9rem; color: #6c757d;">
                            TN=${cm[0][0]}, FP=${cm[0][1]}, FN=${cm[1][0]}, TP=${cm[1][1]}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('spamMetricsContent').innerHTML = html;
        }
        
        // Cargar m√©tricas de intrusiones
        async function loadIntrusionMetrics() {
            document.getElementById('intrusionMetricsLoading').style.display = 'block';
            document.getElementById('intrusionMetricsContent').innerHTML = '';
            
            // Simulaci√≥n de carga de m√©tricas
            setTimeout(() => {
                const metrics = {
                    accuracy: (Math.random() * 1 + 99).toFixed(2),
                    precision: (Math.random() * 2 + 97).toFixed(2),
                    recall: (Math.random() * 2 + 96).toFixed(2),
                    f1_score: (Math.random() * 2 + 96.5).toFixed(2),
                    train_size: '75,583',
                    test_size: '25,195',
                    confusion_matrix: [[48000, 150], [100, 26945]]
                };
                
                displayIntrusionMetrics(metrics);
                document.getElementById('intrusionMetricsLoading').style.display = 'none';
            }, 1000);
        }
        
        // Mostrar m√©tricas de intrusiones
        function displayIntrusionMetrics(metrics) {
            let html = `
                <div class="stats-summary" style="display: flex; justify-content: space-around; background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <div class="stat-item" style="text-align: center;">
                        <div class="stat-number" style="font-size: 1.5rem; font-weight: 700; color: #2b5876;">${metrics.accuracy}%</div>
                        <div class="stat-label" style="font-size: 0.8rem; color: #6c757d;">Accuracy</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="font-size: 1.5rem; font-weight: 700; color: #2b5876;">${metrics.precision}%</div>
                        <div class="stat-label">Precision</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="font-size: 1.5rem; font-weight: 700; color: #2b5876;">${metrics.recall}%</div>
                        <div class="stat-label">Recall</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="font-size: 1.5rem; font-weight: 700; color: #2b5876;">${metrics.f1_score}%</div>
                        <div class="stat-label">F1-Score</div>
                    </div>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">${metrics.train_size}</div>
                        <div class="metric-label">Training Set</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${metrics.test_size}</div>
                        <div class="metric-label">Test Set</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; background: #e3f2fd; padding: 15px; border-radius: 8px;">
                    <strong>Distribuci√≥n de Ataques:</strong>
                    <ul style="margin-top: 10px; color: #495057;">
                        <li>DoS: 45% (neptune, smurf, teardrop)</li>
                        <li>Probe: 25% (portsweep, nmap)</li>
                        <li>R2L: 20% (guess_passwd, warezclient)</li>
                        <li>U2R: 10% (buffer_overflow, rootkit)</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('intrusionMetricsContent').innerHTML = html;
        }
        
        // Limpiar an√°lisis de spam
        function clearSpamAnalysis() {
            document.getElementById('emailText').value = '';
            document.getElementById('spamFileInput').value = '';
            document.getElementById('spamFileInfo').innerHTML = '';
            document.getElementById('spamResultContainer').style.display = 'none';
        }
        
        // Obtener token CSRF (para integraci√≥n con Django)
        function getCsrfToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>
